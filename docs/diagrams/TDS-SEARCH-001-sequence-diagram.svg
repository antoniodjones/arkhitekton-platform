<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg viewBox="0 0 1000 900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#2d3748"/>
    </marker>
    <marker id="arrow-return" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#48bb78"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="500" y="30" font-family="Arial" font-size="20" font-weight="bold" fill="#1a202c" text-anchor="middle">Global Search - Sequence Diagram</text>
  <text x="500" y="50" font-family="Arial" font-size="12" fill="#4a5568" text-anchor="middle">User types "wiki-rtf" and sees results</text>

  <!-- Actors -->
  <rect x="40" y="80" width="80" height="50" fill="#edf2f7" stroke="#4299e1" stroke-width="2" rx="6"/>
  <text x="80" y="110" font-family="Arial" font-size="12" font-weight="bold" fill="#2d3748" text-anchor="middle">User</text>
  <line x1="80" y1="130" x2="80" y2="850" stroke="#cbd5e0" stroke-width="2" stroke-dasharray="5,5"/>

  <rect x="160" y="80" width="100" height="50" fill="#edf2f7" stroke="#4299e1" stroke-width="2" rx="6"/>
  <text x="210" y="100" font-family="Arial" font-size="11" font-weight="bold" fill="#2d3748" text-anchor="middle">Dashboard</text>
  <text x="210" y="115" font-family="Arial" font-size="9" fill="#4a5568" text-anchor="middle">Component</text>
  <line x1="210" y1="130" x2="210" y2="850" stroke="#cbd5e0" stroke-width="2" stroke-dasharray="5,5"/>

  <rect x="300" y="80" width="100" height="50" fill="#edf2f7" stroke="#4299e1" stroke-width="2" rx="6"/>
  <text x="350" y="100" font-family="Arial" font-size="11" font-weight="bold" fill="#2d3748" text-anchor="middle">Debounced</text>
  <text x="350" y="115" font-family="Arial" font-size="9" fill="#4a5568" text-anchor="middle">Hook</text>
  <line x1="350" y1="130" x2="350" y2="850" stroke="#cbd5e0" stroke-width="2" stroke-dasharray="5,5"/>

  <rect x="440" y="80" width="110" height="50" fill="#edf2f7" stroke="#4299e1" stroke-width="2" rx="6"/>
  <text x="495" y="100" font-family="Arial" font-size="11" font-weight="bold" fill="#2d3748" text-anchor="middle">useGlobalSearch</text>
  <text x="495" y="115" font-family="Arial" font-size="9" fill="#4a5568" text-anchor="middle">Hook</text>
  <line x1="495" y1="130" x2="495" y2="850" stroke="#cbd5e0" stroke-width="2" stroke-dasharray="5,5"/>

  <rect x="590" y="80" width="100" height="50" fill="#edf2f7" stroke="#4299e1" stroke-width="2" rx="6"/>
  <text x="640" y="100" font-family="Arial" font-size="11" font-weight="bold" fill="#2d3748" text-anchor="middle">React Query</text>
  <text x="640" y="115" font-family="Arial" font-size="9" fill="#4a5568" text-anchor="middle">Cache</text>
  <line x1="640" y1="130" x2="640" y2="850" stroke="#cbd5e0" stroke-width="2" stroke-dasharray="5,5"/>

  <rect x="730" y="80" width="100" height="50" fill="#edf2f7" stroke="#4299e1" stroke-width="2" rx="6"/>
  <text x="780" y="100" font-family="Arial" font-size="11" font-weight="bold" fill="#2d3748" text-anchor="middle">API</text>
  <text x="780" y="115" font-family="Arial" font-size="9" fill="#4a5568" text-anchor="middle">Express</text>
  <line x1="780" y1="130" x2="780" y2="850" stroke="#cbd5e0" stroke-width="2" stroke-dasharray="5,5"/>

  <rect x="870" y="80" width="100" height="50" fill="#edf2f7" stroke="#4299e1" stroke-width="2" rx="6"/>
  <text x="920" y="110" font-family="Arial" font-size="11" font-weight="bold" fill="#2d3748" text-anchor="middle">PostgreSQL</text>
  <line x1="920" y1="130" x2="920" y2="850" stroke="#cbd5e0" stroke-width="2" stroke-dasharray="5,5"/>

  <!-- Interactions -->
  <!-- Step 1: User types -->
  <path d="M 80 160 L 210 160" stroke="#2d3748" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="145" y="155" font-family="Arial" font-size="10" fill="#2d3748" text-anchor="middle">1. onChange()</text>

  <!-- Step 2: Update value -->
  <rect x="205" y="170" width="10" height="30" fill="#e6fffa" stroke="#38b2ac" stroke-width="1"/>
  <path d="M 210 185 L 350 185" stroke="#2d3748" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="280" y="180" font-family="Arial" font-size="10" fill="#2d3748" text-anchor="middle">2. setValue()</text>

  <!-- Step 3: Debounce wait -->
  <rect x="345" y="200" width="10" height="60" fill="#e6fffa" stroke="#38b2ac" stroke-width="1"/>
  <rect x="365" y="210" width="120" height="40" fill="#fffaf0" stroke="#ed8936" stroke-width="1" rx="4"/>
  <text x="425" y="225" font-family="Arial" font-size="9" fill="#4a5568" text-anchor="middle">Wait 300ms</text>
  <text x="425" y="240" font-family="Arial" font-size="9" fill="#4a5568" text-anchor="middle">(debounce)</text>

  <!-- Step 4: Trigger query -->
  <path d="M 350 270 L 495 270" stroke="#2d3748" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="422" y="265" font-family="Arial" font-size="10" fill="#2d3748" text-anchor="middle">3. debouncedValue</text>

  <!-- Step 5: Check cache -->
  <rect x="490" y="280" width="10" height="180" fill="#e6fffa" stroke="#38b2ac" stroke-width="1"/>
  <path d="M 495 295 L 640 295" stroke="#2d3748" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="567" y="290" font-family="Arial" font-size="10" fill="#2d3748" text-anchor="middle">4. queryFn()</text>

  <!-- Cache check box -->
  <rect x="650" y="305" width="100" height="35" fill="#fffaf0" stroke="#ed8936" stroke-width="1" rx="4"/>
  <text x="700" y="320" font-family="Arial" font-size="9" fill="#4a5568" text-anchor="middle">Check cache</text>
  <text x="700" y="333" font-family="Arial" font-size="9" fill="#4a5568" text-anchor="middle">MISS</text>

  <!-- Step 6: Fetch API -->
  <rect x="635" y="350" width="10" height="100" fill="#e6fffa" stroke="#38b2ac" stroke-width="1"/>
  <path d="M 640 365 L 780 365" stroke="#2d3748" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="710" y="360" font-family="Arial" font-size="10" fill="#2d3748" text-anchor="middle">5. GET /search</text>

  <!-- Step 7: Query DB -->
  <rect x="775" y="380" width="10" height="60" fill="#e6fffa" stroke="#38b2ac" stroke-width="1"/>
  <path d="M 780 395 L 920 395" stroke="#2d3748" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="850" y="390" font-family="Arial" font-size="10" fill="#2d3748" text-anchor="middle">6. SQL Query</text>

  <!-- DB processing -->
  <rect x="915" y="405" width="10" height="25" fill="#e6fffa" stroke="#38b2ac" stroke-width="1"/>

  <!-- Return results -->
  <path d="M 920 445 L 780 445" stroke="#48bb78" stroke-width="2" fill="none" marker-end="url(#arrow-return)" stroke-dasharray="5,5"/>
  <text x="850" y="440" font-family="Arial" font-size="10" fill="#48bb78" text-anchor="middle">14 rows</text>

  <!-- Process results -->
  <rect x="785" y="455" width="90" height="25" fill="#fffaf0" stroke="#ed8936" stroke-width="1" rx="4"/>
  <text x="830" y="472" font-family="Arial" font-size="9" fill="#4a5568" text-anchor="middle">Score &amp; sort</text>

  <!-- Return JSON -->
  <path d="M 780 490 L 640 490" stroke="#48bb78" stroke-width="2" fill="none" marker-end="url(#arrow-return)" stroke-dasharray="5,5"/>
  <text x="710" y="485" font-family="Arial" font-size="10" fill="#48bb78" text-anchor="middle">SearchResponse</text>

  <!-- Cache result -->
  <rect x="650" y="500" width="90" height="20" fill="#fffaf0" stroke="#ed8936" stroke-width="1" rx="4"/>
  <text x="695" y="513" font-family="Arial" font-size="9" fill="#4a5568" text-anchor="middle">Store (5min)</text>

  <!-- Return to hook -->
  <path d="M 640 530 L 495 530" stroke="#48bb78" stroke-width="2" fill="none" marker-end="url(#arrow-return)" stroke-dasharray="5,5"/>
  <text x="567" y="525" font-family="Arial" font-size="10" fill="#48bb78" text-anchor="middle">results</text>

  <!-- Update state -->
  <rect x="500" y="540" width="90" height="25" fill="#fffaf0" stroke="#ed8936" stroke-width="1" rx="4"/>
  <text x="545" y="557" font-family="Arial" font-size="9" fill="#4a5568" text-anchor="middle">Update state</text>

  <!-- Render -->
  <path d="M 495 575 L 210 575" stroke="#48bb78" stroke-width="2" fill="none" marker-end="url(#arrow-return)" stroke-dasharray="5,5"/>
  <text x="352" y="570" font-family="Arial" font-size="10" fill="#48bb78" text-anchor="middle">Trigger render</text>

  <!-- Display UI -->
  <rect x="205" y="585" width="10" height="40" fill="#e6fffa" stroke="#38b2ac" stroke-width="1"/>
  <rect x="220" y="595" width="120" height="25" fill="#fffaf0" stroke="#ed8936" stroke-width="1" rx="4"/>
  <text x="280" y="612" font-family="Arial" font-size="9" fill="#4a5568" text-anchor="middle">Map to Cards</text>

  <!-- Show to user -->
  <path d="M 210 635 L 80 635" stroke="#48bb78" stroke-width="2" fill="none" marker-end="url(#arrow-return)" stroke-dasharray="5,5"/>
  <text x="145" y="630" font-family="Arial" font-size="10" fill="#48bb78" text-anchor="middle">14 results</text>

  <!-- Performance note -->
  <rect x="50" y="680" width="920" height="50" fill="#f0fff4" stroke="#48bb78" stroke-width="2" rx="6"/>
  <text x="510" y="700" font-family="Arial" font-size="11" font-weight="bold" fill="#2d3748" text-anchor="middle">Performance Metrics</text>
  <text x="510" y="720" font-family="Arial" font-size="10" fill="#4a5568" text-anchor="middle">Total Time: ~680ms (API: 650ms, Client: 30ms) | Cache Hit: ~10ms</text>

  <!-- Flow labels -->
  <text x="30" y="165" font-family="Arial" font-size="9" fill="#4a5568">1</text>
  <text x="30" y="190" font-family="Arial" font-size="9" fill="#4a5568">2</text>
  <text x="30" y="235" font-family="Arial" font-size="9" fill="#4a5568">3</text>
  <text x="30" y="275" font-family="Arial" font-size="9" fill="#4a5568">4</text>
  <text x="30" y="300" font-family="Arial" font-size="9" fill="#4a5568">5</text>
  <text x="30" y="370" font-family="Arial" font-size="9" fill="#4a5568">6</text>
  <text x="30" y="400" font-family="Arial" font-size="9" fill="#4a5568">7</text>
  <text x="30" y="450" font-family="Arial" font-size="9" fill="#4a5568">8</text>
  <text x="30" y="495" font-family="Arial" font-size="9" fill="#4a5568">9</text>
  <text x="30" y="535" font-family="Arial" font-size="9" fill="#4a5568">10</text>
  <text x="30" y="580" font-family="Arial" font-size="9" fill="#4a5568">11</text>
  <text x="30" y="640" font-family="Arial" font-size="9" fill="#4a5568">12</text>

  <!-- Legend -->
  <text x="50" y="780" font-family="Arial" font-size="11" font-weight="bold" fill="#2d3748">Legend:</text>
  <line x1="120" y1="775" x2="160" y2="775" stroke="#2d3748" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="170" y="780" font-family="Arial" font-size="10" fill="#4a5568">Request</text>
  <line x1="250" y1="775" x2="290" y2="775" stroke="#48bb78" stroke-width="2" marker-end="url(#arrow-return)" stroke-dasharray="5,5"/>
  <text x="300" y="780" font-family="Arial" font-size="10" fill="#4a5568">Response</text>
  <rect x="380" y="767" width="10" height="16" fill="#e6fffa" stroke="#38b2ac" stroke-width="1"/>
  <text x="400" y="780" font-family="Arial" font-size="10" fill="#4a5568">Active</text>
  <rect x="460" y="767" width="50" height="16" fill="#fffaf0" stroke="#ed8936" stroke-width="1" rx="2"/>
  <text x="520" y="780" font-family="Arial" font-size="10" fill="#4a5568">Processing</text>
</svg>
